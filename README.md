Новый веб-сайт для [Института химии ДВО РАН](http://www.ich.dvo.ru/).

- Docker
- Бэкенд: PHP, Laravel
- Фронтенд: Laravel Blade, TailwindCSS
- База данных: MariaDB
- Сервер: Nginx

## Необходимое для разработки
1. Установить [Docker Engine](https://docs.docker.com/engine/install/) (или [Docker Desktop](https://docs.docker.com/desktop/install/windows-install/) для Windows) и настроить [прокси для него](https://gist.github.com/beeyev/143ec1ae9eb21e7c3b6d55f1bbaf5ce2).
2. Установить [Task](https://taskfile.dev/installation/#get-the-binary).
3. Склонировать себе репозиторий:
``` bash
git clone https://github.com/teatov/ich.dvo.ru.git
```
4. Собрать проект - создастся `.env`, соберутся контейнеры, установятся зависимости, выполнятся миграции:
```bash
task build
```
5. Опционально наполнить базу данных пробными данными:
```bash
task seed
```
6. Добавить в [hosts](https://en.wikipedia.org/wiki/Hosts_(file)#Location_in_the_file_system) строчку:
```
127.0.0.1 ich.dvo.local
```

После этого, если всё прошло как надо, запущенный сайт можно будет открыть по адресу http://ich.dvo.local/.

---
Для запуска проекта используйте команду:
```bash
task up
```

Для грациозной остановки - прервите процесс, нажав `Ctrl+C` в консоли. Если процесс работает на фоне, используйте:
```bash
task stop
```

### Запуск различных команд
Так как всё работает на Docker, команды по типу `php artisan`, `composer` должны выполняться изнутри контейнеров. Если их запускать локально из своей консоли, толку не будет и возможно даже что-то сломается.

В качестве универсальной запускалки используется [Task](https://taskfile.dev/). Его команды выполняют соответствующие команды внутри контейнеров, например `task artisan` запускает `php artisan` внутри контейнера.

Чтобы передать туда какие-нибудь аргументы, отделите их от команды через `--`, например `task artisan -- optimize` под капотом запустит `php artisan optimize`.

Для единообразия лучше всегда запускать всяческие команды именно через Task. Если в какой-нибудь статье просят, например, установить новую зависимость для Composer через `composer install laravel/pint`, то вместо этого пишите `task composer -- install laravel/pint`.

Список и описания команд Task можно посмотреть через `task --list`.

### Обновление фронтенда в прямом эфире
Очень удобно когда страница в браузере обновляется автоматически сразу после изменения кода. Для этого есть Vite с его разработчиковским сервером. Однако у него нет возможности запускаться на фоне, так что ему обязательно нужно занимать свободный терминал.

Из-за этого его не получается по-удобному внедрить в Task. Самой простой альтернативой является запуск сервера Vite в новом отдельном терминале или через мультиплексер.

Запуск сервера Vite происходит с помощью команды:
```bash
npm run dev
```

## Развёртывание на рабочем окружении 
1. Пробросить нужные переменные окружения.
2. Убедиться что Docker установлен.
3. Запустить развёртывание:
```bash
task deploy
```
4. ???
5. PROFIT!
