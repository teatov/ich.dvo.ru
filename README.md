Новый веб-сайт для [Института химии ДВО РАН](http://www.ich.dvo.ru/).

- Docker
- Бэкенд: PHP, Laravel
- Фронтенд: Laravel Blade, TailwindCSS
- База данных: MariaDB
- Сервер: Nginx
- Рантайм для JS: Bun
- Обратный прокси: Traefik

## Необходимое для разработки
1. Установить [Docker Engine](https://docs.docker.com/engine/install/)
(или [Docker Desktop](https://docs.docker.com/desktop/install/windows-install/)
для Windows) и настроить [прокси для него](https://gist.github.com/beeyev/143ec1ae9eb21e7c3b6d55f1bbaf5ce2).
2. Установить [Task](https://taskfile.dev/installation/#get-the-binary).
3. Склонировать себе репозиторий:
``` bash
git clone https://github.com/teatov/ich.dvo.ru.git
```
4. Собрать проект - создастся `.env`, соберутся контейнеры,
установятся зависимости, выполнятся миграции:
```bash
task build
```
5. Опционально наполнить базу данных пробными данными:
```bash
task seed
```
6. Добавить в [hosts](https://en.wikipedia.org/wiki/Hosts_(file)#Location_in_the_file_system) строчку:
```
127.0.0.1 ich.dvo.local
```

После этого, если всё прошло как надо,
запущенный сайт можно будет открыть по адресу http://ich.dvo.local/.

---
Для запуска проекта используйте команду:
```bash
task up
```

Или если нужно запустить их на фоне:
```bash
task up-d
```

Для грациозной остановки - прервите процесс, нажав `Ctrl+C` в консоли.
Если процесс работает на фоне, используйте:
```bash
task stop
```

### Запуск различных команд
Так как всё работает на Docker, команды по типу `php artisan`,
`composer` или `bun` должны выполняться изнутри контейнеров.
Если их запускать локально из своей консоли,
толку не будет и возможно даже что-то сломается.

В качестве универсальной запускалки используется [Task](https://taskfile.dev/).
Его команды выполняют соответствующие команды внутри контейнеров,
например `task artisan` запускает `php artisan` внутри контейнера.

Чтобы передать туда какие-нибудь аргументы, отделите их от команды через `--`,
например `task artisan -- optimize` под капотом запустит `php artisan optimize`.

Для единообразия лучше всегда запускать всяческие команды именно через Task.
Если в какой-нибудь статье просят, например, установить новую зависимость
для Composer через `composer install laravel/pint`,
то вместо этого пишите `task composer -- install laravel/pint`.

Список и описания команд Task можно посмотреть через `task --list`.

### Работа с Bun
Вместо Node с NPM у нас [Bun](https://bun.sh/), ибо он в разы быстрее,
как минимум, устанавливает зависимости.

Он работает как безболезненная замена для NPM, так что если
в интернете просят установить пакет через `npm install dotenv`,
то у нас будет `task bun -- install dotenv`.

### Обновление фронтенда в прямом эфире
Очень удобно когда страница в браузере обновляется автоматически сразу
после изменения кода. Для этого есть Vite с его разработчиковским сервером.

Однако у него нет возможности запускаться на фоне,
поэтому ему обязательно нужно занимать свободный терминал.
Так что нужно запускать Vite в новом отдельном терминале или через мультиплексер.

Запуск сервера Vite происходит в отдельном контейнере с помощью команды:
```bash
task vite
```

### Коммиты
Для создания сообщений коммитов используется Commitizen.
Это утилита для командной строки, позволяющая стандартизировать сообщения
в коммитах. Иначе они быстро превращаются в бардак.

Commitizen с нужным конфигом можно установить
через `pip install commitizen cz-ru`, если есть Python.

Чтобы отправить коммит, не используйте панель Source Control в VSCode
или обычный `git commit`, а используйте команду `cz commit`,
после того как добавите нужные файлы в `stage`.

После запуска команды нужно будет указать:
- **тип изменений** - нужно будет выбрать тип, которым можно
однозначно обозначить характер изменений
- **область изменений** - где именно были изменения?
укажите название файла, класса, папки или неймспейс
- **краткое описание** - лаконичное описание изменений, ничего лишнего
- **подробное описание** - более полное описание изменений,
здесь уже можно писать сколько угодно. Если что-то особо непонятное,
следует написать ПОЧЕМУ были внесены такие изменения
- **наличие ломающих изменений** - были ли изменения, после которых
всем остальным членам команды нужно будет сделать что-то самим?
например, установлен новый NPM пакет - всем остальным тоже надо его установить,
чтобы всё работало
- **примечания** - подробная информация про ломающие изменения и задачи,
которые этот коммит закрывает

Если нужно закоммитить всё изменённые файлы, а бегать между терминаломи кнопками
VSCode не хочется, можно добавить все файлы в `stage` командой `git add .`,
затем уже `cz commit`, и затем отправить изменения в GitHub через `git push`.

## Развёртывание на рабочем окружении 
1. Пробросить нужные переменные окружения.
2. Убедиться что Docker установлен.
3. Запустить развёртывание:
```bash
task deploy
```
4. ???
5. PROFIT!
